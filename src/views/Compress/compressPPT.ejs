<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>
    <%= title %>
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/output.css" rel="stylesheet">
</head>

<body class="min-h-screen bg-gray-50 flex flex-col">

  <!-- Navbar -->
  <header>
    <%- include('../partials/nav') %>
  </header>

  <!-- Compress PPT Section -->
  <main class="flex-1 flex items-center justify-center px-4">
    <div class="w-full max-w-xl bg-white rounded-xl shadow-lg p-8">

      <!-- Heading -->
      <h2 class="text-3xl font-bold text-center text-gray-800">
        Compress PowerPoint
      </h2>
      <p class="text-center text-gray-600 mt-2">
        Reduce PPT / PPTX size without breaking slides
      </p>

      <!-- Error -->
      <% if (error) { %>
        <div class="mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded-lg text-center">
          <%= error %>
        </div>
        <% } %>

          <!-- Success Message (Stats + Progress + Download) -->
          <% if (downloadLink) { %>
            <div id="success-container" class="mt-6">

              <!-- Statistics Card -->
              <div class="mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                <h3 class="text-blue-800 font-semibold mb-2 text-center">Compression Results</h3>
                <div class="grid grid-cols-3 gap-2 text-center text-sm">
                  <div>
                    <p class="text-gray-500">Original</p>
                    <p class="font-bold text-gray-800">
                      <%= stats.before %>
                    </p>
                  </div>
                  <div>
                    <p class="text-gray-500">Compressed</p>
                    <p class="font-bold text-green-600">
                      <%= stats.after %>
                    </p>
                  </div>
                  <div>
                    <p class="text-gray-500">Reduction</p>
                    <p class="font-bold text-blue-600">
                      <%= stats.reduction %>
                    </p>
                  </div>
                </div>
              </div>

              <!-- Progress Bar -->
              <div id="progress-wrapper" class="w-full bg-gray-200 rounded-full h-4 mb-4 overflow-hidden shadow-inner">
                <div id="progress-bar" class="bg-blue-600 h-4 rounded-full relative"
                  style="width: 0%; transition: width 0.1s linear;">
                  <div class="absolute inset-0 bg-white opacity-20 animate-pulse"></div>
                </div>
              </div>
              <p id="progress-text" class="text-center text-blue-700 font-medium animate-pulse mb-2">Finalizing PPTX...
              </p>

              <!-- Download Button (Initially Hidden) -->
              <div id="download-wrapper" class="hidden">
                <div class="mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-center">
                  <p class="font-medium mb-2">Ready for Download ðŸŽ‰</p>
                  <a href="<%= downloadLink %>"
                    onclick="setTimeout(() => { window.location.href = '/compress/ppt'; }, 1000);"
                    class="block w-full text-center bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition shadow-md">
                    Download PPTX
                  </a>
                </div>

                <a href="/compress/ppt" class="block text-center text-sm text-gray-500 hover:text-gray-700 mt-2">
                  Compress another file
                </a>
              </div>

              <script>
                document.addEventListener('DOMContentLoaded', () => {
                  const progressBar = document.getElementById('progress-bar');
                  const progressWrapper = document.getElementById('progress-wrapper');
                  const progressText = document.getElementById('progress-text');
                  const downloadWrapper = document.getElementById('download-wrapper');

                  let width = 0;
                  const interval = setInterval(() => {
                    if (width >= 100) {
                      clearInterval(interval);
                      // Animation complete
                      setTimeout(() => {
                        progressWrapper.classList.add('hidden');
                        progressText.classList.add('hidden');
                        downloadWrapper.classList.remove('hidden');
                      }, 500);
                    } else {
                      width++;
                      progressBar.style.width = width + '%';
                    }
                  }, 15); // 1.5s total
                });
              </script>
            </div>
            <% } else { %>

              <!-- Upload Form -->
              <form action="/compress/ppt/result" method="POST" enctype="multipart/form-data" class="mt-8">

                <!-- Drag & Drop -->
                <label for="ppt" id="drop-zone"
                  class="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer bg-gray-50 hover:bg-gray-100 transition">
                  <div class="text-center">
                    <p class="text-gray-700 font-medium">
                      Drag & drop your PPT here
                    </p>
                    <p class="text-sm text-gray-500 mt-1">
                      or click to browse (.ppt, .pptx)
                    </p>
                  </div>

                  <input id="ppt" name="ppt" type="file" class="hidden" accept=".ppt,.pptx" required />
                </label>

                <!-- Selected file -->
                <p id="file-name" class="mt-3 text-center text-sm text-gray-600 hidden">
                  Selected file: <span class="font-medium"></span>
                </p>

                <!-- Compression Level -->
                <div class="mt-6">
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Compression Level
                  </label>

                  <select name="compressionLevel"
                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    <option value="normal">Normal â€“ Best balance</option>
                    <option value="low">Less â€“ Faster, larger file</option>
                    <option value="extreme">Extreme â€“ Smallest size</option>
                  </select>

                  <p class="text-xs text-gray-500 mt-1">
                    Extreme works best for image-heavy presentations
                  </p>
                </div>

                <!-- NEW: Media removal toggle -->
                <div class="mt-5 flex items-start gap-3">
                  <input type="checkbox" name="removeMedia" id="removeMedia" class="mt-1">
                  <label for="removeMedia" class="text-sm text-gray-700">
                    Remove embedded videos & audio (recommended for email sharing)
                  </label>
                </div>

                <!-- Submit -->
                <button type="submit" id="submitBtn"
                  class="mt-6 w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition flex items-center justify-center gap-2">
                  <span id="btnText">Compress PPT</span>

                  <!-- Spinner (hidden by default) -->
                  <svg id="spinner" class="hidden animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg"
                    fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                  </svg>
                </button>

                <!-- Tip -->
                <p class="mt-3 text-xs text-center text-gray-500">
                  Tip: PPTs with images & videos compress significantly more
                </p>

              </form>
              <% } %>

    </div>
  </main>

  <!-- Drag & Drop Script -->
  <script>
    const input = document.getElementById('ppt');
    const dropZone = document.getElementById('drop-zone');
    const fileName = document.getElementById('file-name');
    const fileText = fileName.querySelector('span');

    const form = document.querySelector('form');
    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');
    const btnText = document.getElementById('btnText');

    input.addEventListener('change', () => {
      if (input.files.length) {
        fileText.textContent = input.files[0].name;
        fileName.classList.remove('hidden');
      }
    });

    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.classList.add('bg-blue-50', 'border-blue-400');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('bg-blue-50', 'border-blue-400');
    });

    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('bg-blue-50', 'border-blue-400');

      if (e.dataTransfer.files.length) {
        input.files = e.dataTransfer.files;
        fileText.textContent = e.dataTransfer.files[0].name;
        fileName.classList.remove('hidden');
      }
    });

    form.addEventListener('submit', () => {
      // Disable button
      submitBtn.disabled = true;
      submitBtn.classList.add('opacity-70', 'cursor-not-allowed');

      // Show spinner
      spinner.classList.remove('hidden');

      // Change text
      btnText.textContent = 'Compressing...';
    });
  </script>

</body>

</html>