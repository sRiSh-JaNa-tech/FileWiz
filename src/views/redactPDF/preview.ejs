<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>
    <%= title %>
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/output.css" rel="stylesheet">

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap');

    :root {
      --primary: #f43f5e;
      --primary-hover: #e11d48;
      --glass-bg: rgba(255, 255, 255, 0.7);
      --glass-border: rgba(255, 255, 255, 0.4);
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: radial-gradient(circle at top right, #fff5f5, #f8fafc);
    }

    .glass-card {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
    }

    .page-wrapper {
      position: relative;
      transition: transform 0.2s ease;
    }

    .textLayer {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      overflow: hidden;
      opacity: 0;
      line-height: 1.0;
      text-indent: 0;
    }

    .textLayer span,
    .textLayer br {
      color: transparent;
      position: absolute;
      white-space: pre;
      cursor: crosshair;
      transform-origin: 0% 0%;
    }

    .redaction-box {
      position: absolute;
      background: black;
      opacity: 0.7;
      border: 1px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      transition: opacity 0.2s ease, transform 0.1s ease;
    }

    .redaction-box:hover {
      opacity: 0.9 !important;
      transform: scale(1.01);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #e2e8f0;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #cbd5e1;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #fb7185);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(244, 63, 94, 0.3);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
    }

    .gradient-text {
      background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- Navbar -->
  <header class="sticky top-0 z-50">
    <%- include('../partials/nav') %>
  </header>

  <main class="flex-1 max-w-7xl mx-auto px-6 py-8 w-full">

    <!-- Header Section -->
    <div class="flex flex-col md:flex-row md:items-end justify-between mb-8 gap-4">
      <div>
        <nav class="flex mb-2" aria-label="Breadcrumb">
          <ol class="inline-flex items-center space-x-1 md:space-x-3 text-xs text-slate-400 font-medium">
            <li class="inline-flex items-center">
              <span class="hover:text-slate-600">Redaction Tool</span>
            </li>
            <li>
              <div class="flex items-center">
                <svg class="w-2 h-2 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                  viewBox="0 0 6 10">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="m1 9 4-4-4-4" />
                </svg>
                <span class="ml-1 md:ml-2">Preview & Edit</span>
              </div>
            </li>
          </ol>
        </nav>
        <h1 class="text-3xl md:text-4xl font-bold gradient-text tracking-tight">
          Redaction Studio
        </h1>
        <p class="text-slate-500 mt-2 max-w-xl text-sm md:text-base leading-relaxed">
          Draw boxes over sensitive areas like names, images, or account numbers to permanently scrub them from your
          document.
        </p>
      </div>

      <div class="flex items-center gap-3">
        <span class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Secure Processing</span>
      </div>
    </div>

    <!-- Layout Container -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

      <!-- PDF Preview Area -->
      <div class="lg:col-span-8">
        <div class="glass-card rounded-2xl overflow-hidden border border-slate-200/60 p-1">
          <div class="bg-slate-50/50 border-b border-slate-200/60 px-5 py-3 flex items-center justify-between">
            <div class="flex items-center gap-2">
              <div class="w-3 h-3 rounded-full bg-slate-300"></div>
              <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">Document Editor</span>
            </div>
            <div id="page-counter"
              class="text-xs font-medium text-slate-400 bg-white px-2 py-1 rounded-md border border-slate-100">
              Previewing Content
            </div>
          </div>

          <div id="pdf-container" class="space-y-6 overflow-y-auto max-h-[80vh] p-6 bg-slate-100/30 scroll-smooth">
            <!-- PDF pages injected here -->
          </div>
        </div>
      </div>

      <!-- Control Sidebar -->
      <div class="lg:col-span-4 space-y-6">

        <!-- Redactions List Card -->
        <div class="glass-card rounded-2xl p-6 border border-slate-200/60">
          <div class="flex items-center justify-between mb-5">
            <h3 class="text-sm font-bold text-slate-800 uppercase tracking-wider">
              Selected Areas
            </h3>
            <span id="redaction-count-badge"
              class="bg-slate-100 text-slate-600 text-[10px] font-bold px-2 py-1 rounded-full border border-slate-200">
              0 Items
            </span>
          </div>

          <div class="relative min-h-[200px]">
            <ul id="redaction-list"
              class="text-sm space-y-3 max-h-[400px] overflow-y-auto pr-1 transition-all duration-300">
              <div class="flex flex-col items-center justify-center py-10 text-center">
                <div class="w-12 h-12 bg-slate-50 rounded-full flex items-center justify-center mb-3">
                  <svg class="w-6 h-6 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122">
                    </path>
                  </svg>
                </div>
                <p class="text-slate-400 text-xs font-medium">No areas selected yet.</p>
                <p class="text-slate-300 text-[10px] mt-1">Drag anywhere on the PDF to start.</p>
              </div>
            </ul>
          </div>

          <div class="mt-8 pt-6 border-t border-slate-100">
            <div class="flex items-start gap-3 p-4 bg-amber-50/50 rounded-xl border border-amber-100">
              <div class="mt-0.5">
                <svg class="w-4 h-4 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd"
                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                    clip-rule="evenodd"></path>
                </svg>
              </div>
              <div>
                <h4 class="text-xs font-bold text-amber-800">Permanent Action</h4>
                <p class="text-[10px] text-amber-700/80 mt-1 leading-relaxed">
                  Redaction permanently scrubs data from the file structure. Once saved, it cannot be undone.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Card -->
        <div class="glass-card rounded-2xl p-6 border border-slate-200/60 bg-white/40">
          <button id="apply-btn" onclick="submitRedactions()"
            class="btn-primary w-full text-white py-3.5 px-6 rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 group disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
            disabled>
            <span>Apply Redaction</span>
            <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor"
              viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
            </svg>
          </button>

          <div class="mt-6 flex flex-col gap-3">
            <a href="/redaction"
              class="flex items-center justify-center gap-2 text-[11px] font-bold text-slate-400 hover:text-slate-600 uppercase tracking-widest transition-colors py-2">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
              Upload different file
            </a>
          </div>
        </div>

      </div>
    </div>
  </main>

  <%- include('../partials/redactPrev') %>

</body>

</html>